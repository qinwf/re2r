---
title: "Introduction to `RE2`"
output: html_document
vignette: >
  %\VignetteIndexEntry{Introduction to RE2}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include=FALSE}
options( markdown.HTML.template = system.file("misc", "docco-template.html", package = "knitr"))
library(re2r)
```

This Article is derived from [An Introduction to Regular Expressions](http://www.codeproject.com/Articles/939/An-Introduction-to-Regular-Expressions)

## Table of Content

1. What are Regular Expressions?
2. Why would we use Regular Expressions
3. Where to use Regular Expressions
4. How to use the Regular Expression Syntax Basics


## What are Regular Expressions?

Regular expressions are a way to search for substrings ("matches") in strings. This is done by searching with "patterns" through the string.

Example:

You probably know the `*` and `?` charachters used in the dir command on the command line. The `*` character means "zero or more arbitrary characters" and the `?` means "one arbitrary character". 

When using a pattern like `text?.*`, it will find files like

    textf.txt
    text1.R
    text9.Rmd

But it will not find files like

    text.txt
    text.R
    text.Rmd

This is exactly the way REs work. While the `*` and `?` are a very limited ways of pattern matching, REs supply a much broader spectrum of describing patterns.

## Why would we use Regular Expressions

Example usages could be:

1. Remove all occurences of a specific tag from text file
2. Check whether an e-mail address is well-formed

### Standard Regular Expression Operations

Basically we can do the following operations on a string with REs:

#### 1. Test for a pattern

Search through a string and check whether a pattern matches a substring, returning true or false.

#### 2. Extract a substring

Search for a substring and return that substring.

#### 3. Replace a substring

Search for a substring that matches a pattern and replace it by another string.

## Where to use Regular Expressions


### 1. Base R functions with `PCRE`

Base R functions such as `regexpr` use [PCRE](http://www.pcre.org/) when given the `perl=TRUE` argument. PCRE includes many useful features, such as [named capture](https://github.com/tdhock/regex-tutorial#motivation-for-using-named-capture-regular-expressions-5-minutes), but has an exponential time complexity.

### 2. Base R functions with `TRE`

Base R functions such as `regexpr` use [TRE](https://github.com/laurikari/tre) when given the `perl=FALSE` argument. TRE has a polynomial time complexity but does not include named capture groups.

### 3. `stringi` with `ICU`

`stringr::str_match` and `stringi::stri_match` use the regex engine from the ICU library, which has an exponential time complexity. The stringi package does not support named capture yet as such a feature set is still considered as [experimental in ICU](https://github.com/hadley/stringr/pull/16).

### 4. `re2r` with `RE2`

`RE2` is a primarily DFA based regexp engine from Google that is very fast at matching large amounts of text. It is has a `polynomial time complexity` (or `fast and scalable` in general case), but it does not support `look behind` and some regular expression features.

### above all

Although being slightly different to use (because of the design of the engines), all are quite similar to `Perl`'s implementation of REs. 

## How to use Regular Expressions from re2r

As stated, I do all examples in `re2r`. Therefore here a quick overview over the most common methods on how to execute a regular expression in `re2r`.

### 1. Search a string for a pattern

Tips: Hey, `Windows` user. If you are not using English as your default language on Windows, please consider run this line to set locale setting to ensure the input strings are valid UTF-8 strings.

```{r, eval=FALSE, include=TRUE}
Sys.setlocale(locale = "English")
```

Here a quick overview over the most common methods on how to execute a regular expression.

```{r, eval=FALSE, include=TRUE}
re2_match(pattern, string)
```

Searches the string expression for the occurence(s) of a substring that matches 'pattern' and returns boolean result.

```{r}
test_string = "this is just one test";
re2_match("(o.e)", test_string)
```

`.` means `any character, possibly including newline` . For more syntax, you can check out the `RE2 Syntax` vignette.

With `value = TRUE` option, function will return the capture groups with `()`.

```{r,collapse=TRUE}
(res = re2_match("(o.e)", test_string, value = TRUE))
str(res)
```

The return result is a data.frame. `?1` is the first capture group and it is unnamed group.

We can create named capture group with `(?P<name>pattern)` syntax.

```{r,collapse=TRUE}
(res = re2_match("(?P<testname>this)( is)", test_string, value = TRUE))
str(res)
```

With `all = TRUE` option, function will return the all of patterns in a string instead of just the first one.

```{r,collapse=TRUE}
(res = re2_match("(is)", test_string, value = TRUE, all = TRUE))
str(res)
```

`!n` is the index of the input string. We can provide a character vector to a pattern.

```{r,collapse=TRUE}
test_string = c("this is just one test", "the second test");
(res = re2_match("(is)", test_string, value = TRUE, all = TRUE))
str(res)
```

If there is no capture group, and `value = TRUE`, the matched origin strings will be returned.

```{r,collapse=TRUE}
test_string = c("this is just one test", "the second test");
(res = re2_match("is", test_string, value = TRUE))
str(res)
```

### 2. Replace a substring

```{r, eval=FALSE, include=TRUE}
re2_replace(pattern, rewrite, input)
```

Searches the string "input string" for the occurence(s) of a substring that matches 'pattern' and replaces the found substrings with "rewrite text".

```{r}
input_string = "this is just one test";
new_string = "my"
re2_replace("(o.e)", new_string, input_string)
```

### 3. Extract a substring

```{r, eval=FALSE, include=TRUE}
re2_extract(pattern, input, rewrite = optional)
```

Searches the string "input string" for the occurence(s) of a substring that matches 'pattern' and return the found substrings with "rewrite text".

```{r}
re2_extract("(.)","yabba dabba doo")
re2_extract("(.*)@([^.]*)","test@me.com","\\2!\\1")
```

`\\1` and `\\2` are the first and second capture groups.

### 4. `Regular Expression Object` for better performance

We can create a regular expression object (RE2 object) from a string. It will reduce the time to parse the syntax of the same pattern. 

And this will also give us more option for the pattern. run `help(re2)` to get more detials.

```{r,collapse=TRUE}
regexp = re2("test",case_sensitive = FALSE)
print(regexp)
regexp %<~% "(?P<first>1*)"
regexp
```

`%<~%` is a operator to create a new RE2 object.

```{r,collapse=TRUE}
regexp = re2("test",case_sensitive = FALSE)
re2_match(regexp, "TEST")
re2_replace(regexp, "ops", "TEST")
```

If you come from a `Perl` world, you may be insterested in `%=~%`  `%!~%`.

```{r,collapse=TRUE}
"TEST" %=~% regexp
"TEST" %!~% regexp
```

## Want to learn more?

For more examples, you can check out `RE2 Example` vignette.
